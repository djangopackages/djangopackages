{% load humanize i18n waffle_tags %}
{% if packages %}
    <div class="overflow-y-auto max-h-60 rounded-md border shadow-md border-border bg-popover text-popover-foreground">
        {% for package in packages %}
            <button
                type="submit"
                name="package"
                value="{{ package.id }}"
                class="p-3 w-full text-left border-b transition-colors last:border-0 suggestion-item border-border/50 group hover:bg-accent hover:text-accent-foreground"
            >
                <div class="flex gap-3 items-start">
                    <div class="flex-shrink-0 mt-1 transition-colors suggestion-icon text-muted-foreground group-hover:text-accent-foreground">
                        <i class="text-lg ph-bold ph-package"></i>
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="flex gap-2 justify-between items-center">
                            <span class="font-medium break-words text-foreground group-hover:text-accent-foreground">{{ package.title }}</span>
                        </div>
                        {% if package.repo_description %}
                            <p class="mt-0.5 text-xs text-muted-foreground line-clamp-2 group-hover:text-accent-foreground/80">
                                {{ package.repo_description }}
                            </p>
                        {% endif %}
                        <div class="flex flex-wrap gap-2 items-center mt-2">
                            {% if package.category %}
                                <span class="text-xs whitespace-nowrap badge suggestion-badge text-muted-foreground group-hover:text-accent-foreground/80">
                                    {{ package.category.title }}
                                </span>
                            {% endif %}
                            {% if package.latest_version %}
                                <span class="flex gap-1 items-center text-xs whitespace-nowrap badge suggestion-badge text-muted-foreground group-hover:text-accent-foreground/80" title="{% translate 'Latest PyPI Version' %}">
                                    <i class="text-xs ph-bold ph-tag"></i>
                                    {{ package.latest_version_number }}
                                </span>
                                {% if package.latest_version.upload_time %}
                                    <span class="flex gap-1 items-center text-xs whitespace-nowrap badge suggestion-badge text-muted-foreground group-hover:text-accent-foreground/80" title="{% translate 'Last Released' %}">
                                        <i class="text-xs ph-bold ph-calendar-check"></i>
                                        {{ package.latest_version.upload_time|date }}
                                    </span>
                                {% endif %}
                            {% endif %}
                            <span class="flex gap-1 items-center text-xs whitespace-nowrap badge suggestion-badge text-muted-foreground group-hover:text-accent-foreground/80" title="{% translate 'Stars' %}">
                                <i class="ph-bold ph-star"></i>
                                {{ package.repo_watchers|intcomma|default:0 }}
                            </span>
                            <span class="flex gap-1 items-center text-xs whitespace-nowrap badge suggestion-badge text-muted-foreground group-hover:text-accent-foreground/80" title="{% translate 'Forks' %}">
                                <i class="text-xs ph-bold ph-git-fork"></i>
                                {{ package.repo_forks|default:0 }}
                            </span>
                        </div>
                    </div>
                </div>
            </button>
        {% endfor %}
    </div>
{% elif request.GET.q %}
    <div class="p-4 text-center rounded-md border shadow-md text-muted-foreground bg-popover border-border">
        <p>{% translate "No packages found matching your query." %}</p>
    </div>
{% endif %}
