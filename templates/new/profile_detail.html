{% extends "new/base.html" %}
{% load i18n package_tags page_metadata_tags profile_tags waffle_tags %}

{% block metadata %}
    {% translate "Profile for " as trans_title %}
    {% page_metadata page_title=trans_title|add:profile.github_account %}
{% endblock metadata %}

{% block content %}
    <div class="container py-8 px-4 mx-auto">
        <div class="flex flex-col gap-8 md:flex-row">
        <!-- Sidebar -->
            <div class="space-y-6 w-full md:w-1/4">
                <div class="flex flex-col items-center md:items-start">
                <!-- Avatar placeholder -->
                    <div class="flex overflow-hidden justify-center items-center mb-4 w-64 h-64 text-6xl text-green-800 rounded-full border shadow-sm bg-green-800/20 border-green-800/20">
                        <span class="font-bold">{{ local_profile.github_account|slice:":2"|upper }}</span>
                    </div>

                    <h1 class="text-2xl font-bold text-gray-900">{{ user.get_full_name|default:profile.github_account }}</h1>
                    <p class="text-xl font-light text-gray-500">{{ local_profile.github_account }}</p>

                    {% if request.user == user %}
                        <a href="{% url 'profile_edit' %}" class="mt-4 w-full btn-secondary">
                            {% translate "Edit profile" %}
                        </a>
                    {% endif %}

                    <div class="mt-6 space-y-3 w-full text-sm text-gray-600">
                        {% if local_profile.github_account %}
                            <div class="flex items-center group">
                                <i class="mr-2 text-lg text-gray-500 group-hover:text-gray-900 ph-bold ph-github-logo"></i>
                                <a href="https://github.com/{{ local_profile.github_account }}" target="_blank" class="text-gray-500 group-hover:text-gray-900 hover:underline">@{{ local_profile.github_account }}</a>
                            </div>
                        {% endif %}

                        {% if local_profile.bitbucket_url %}
                            <div class="flex items-center group">
                                <i class="mr-2 text-lg text-gray-500 group-hover:text-gray-900 ph-bold ph-git-branch"></i>
                                <a href="https://bitbucket.org/{{ local_profile.bitbucket_url }}" target="_blank" class="text-gray-500 group-hover:text-gray-900 hover:underline">{{ local_profile.bitbucket_url }}</a>
                            </div>
                        {% endif %}

                        {% if local_profile.gitlab_url %}
                            <div class="flex items-center group">
                                <i class="mr-2 text-lg text-gray-500 group-hover:text-gray-900 ph-bold ph-gitlab-logo"></i>
                                <a href="https://gitlab.com/{{ local_profile.gitlab_url }}" target="_blank" class="text-gray-500 group-hover:text-gray-900 hover:underline">{{ local_profile.gitlab_url }}</a>
                            </div>
                        {% endif %}

                        {% if extra_fields %}
                            {% for field in extra_fields %}
                                <div class="flex items-center group">
                                    <i class="mr-2 text-lg text-gray-500 group-hover:text-gray-900 ph-bold ph-link"></i>
                                    <a href="{{ field.url }}" target="_blank" class="text-gray-500 group-hover:text-gray-900 hover:underline" title="{{ field.label }}">{{ field.url|truncatechars:30 }}</a>
                                </div>
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>
                {% include "new/partials/_ethicalads-tag.html" with ea_type="image" ea_id="profile-sidebar" ea_inner_class="flex justify-center" %}
            </div>

        <!-- Main Content -->
            <div class="w-full md:w-3/4">

            <!-- Packages Contributed To -->
                <div class="mb-8 card"
                     hx-get="{% url 'profile_contributed_packages' github_account=profile.github_account %}?page=1"
                     hx-trigger="load"
                     hx-swap="outerHTML"
                >
                    <div class="card-header">
                        <h3 class="flex gap-2 items-center text-xl font-semibold">
                            <i class="text-xl ph-bold ph-package"></i>
                            {% translate "Packages Contributed To" %}
                        </h3>
                    </div>
                    <div class="card-content">
                        <div class="py-8 text-center">
                            <i class="text-3xl animate-spin ph-bold ph-circle-notch text-muted-foreground"></i>
                            <p class="mt-2 text-sm text-muted-foreground">
                                {% translate "Loading packages..." %}
                            </p>
                        </div>
                    </div>
                </div>

                {% if profile.share_favorites or self_profile %}
                <!-- Favorite Packages -->
                    <div class="mb-8 card"
                         hx-get="{% url 'profile_favorite_packages' github_account=profile.github_account %}?page=1"
                         hx-trigger="load"
                         hx-swap="outerHTML"
                    >
                        <div class="card-header">
                            <h3 class="flex gap-2 items-center text-xl font-semibold">
                                <i class="text-xl ph-bold ph-heart"></i>
                                {% translate "Favorite Packages" %}
                            </h3>
                        </div>
                        <div class="card-content">
                            <div class="py-8 text-center">
                                <i class="text-3xl animate-spin ph-bold ph-circle-notch text-muted-foreground"></i>
                                <p class="mt-2 text-sm text-muted-foreground">
                                    {% translate "Loading favorites..." %}
                                </p>
                            </div>
                        </div>
                    </div>
                {% endif %}

            </div>
        </div>
    </div>
{% endblock content %}
