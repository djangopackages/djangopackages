{% load i18n static %}
<!-- Header -->
<header class="sticky top-0 z-40 border-b bg-primary">
    <div class="container flex justify-between items-center px-4 mx-auto h-16">
        <div class="flex items-center space-x-6">
            <a href="{% url 'home' %}" class="flex items-center space-x-2">
                <img src="{% static 'img/logo_squares.png' %}" class="w-auto h-8" />
                <span class="text-xl font-bold text-primary-foreground">{{ SITE_TITLE }}</span>
            </a>
            <nav class="hidden items-center space-x-4 md:flex">
                <a
                    href="{% url 'packages' %}"
                    class="py-2 px-3 text-sm font-medium rounded-md transition-colors text-primary-foreground/80 hover:text-primary-foreground hover:bg-primary-foreground/5"
                >
                    {% translate "Packages" %}
                </a>
                <a
                    href="{% url 'grids' %}"
                    class="py-2 px-3 text-sm font-medium rounded-md transition-colors text-primary-foreground/80 hover:text-primary-foreground hover:bg-primary-foreground/5"
                >
                    {% translate "Grids" %}
                </a>
            </nav>
        </div>

        <div class="flex items-center space-x-4">
            {% if request.resolver_match.url_name != 'home' %}
                <!-- Search Bar - Only shown on non-home pages -->
                <div class="hidden relative lg:block">
                    <div class="relative group">
                        <i
                            class="absolute left-3 top-1/2 text-base transition-colors transform -translate-y-1/2 ph-bold ph-magnifying-glass text-primary-foreground/60 group-focus-within:text-muted-foreground"
                        ></i>
                        <input
                            id="navbar-search-input"
                            type="text"
                            name="q"
                            placeholder="{% translate 'Search packages...' %}"
                            class="py-2 pr-12 pl-10 w-80 h-9 rounded-md border-2 transition-colors focus:outline-none peer bg-primary-foreground/10 border-primary-foreground/20 text-primary-foreground placeholder:text-primary-foreground/60 focus:bg-background focus:text-foreground focus:border-primary focus:placeholder:text-muted-foreground"
                            autocomplete="off"
                            hx-get="{% url 'search_suggestions' %}"
                            hx-trigger="keyup changed delay:300ms, focus[this.value.trim().length > 0]"
                            hx-target="#navbar-suggestions-dropdown"
                            hx-vals='{"dropdown_id": "navbar-suggestions-dropdown"}'
                            hx-indicator="#navbar-search-spinner"
                        />
                        <div
                            class="flex absolute right-3 top-1/2 items-center space-x-1 transform -translate-y-1/2"
                        >
                            <div id="navbar-search-spinner" class="htmx-indicator">
                                <i
                                    class="animate-spin ph-bold ph-circle-notch text-muted-foreground"
                                ></i>
                            </div>
                            <div
                                class="hidden items-center py-0.5 px-1.5 space-x-1 text-xs rounded border transition-colors xl:flex text-primary-foreground/60 bg-primary-foreground/10 border-primary-foreground/20 group-focus-within:text-muted-foreground group-focus-within:border-muted-foreground/30"
                            >
                                <span>&#8984; /</span>
                            </div>
                        </div>
                        <!-- Suggestions Dropdown -->
                        <div
                            id="navbar-suggestions-dropdown"
                            class="hidden overflow-hidden absolute right-0 left-0 top-full z-50 mt-2 rounded-xl border-2 shadow-xl empty:hidden peer-focus:block peer-placeholder-shown:hidden bg-popover/95 backdrop-blur-sm border-border/50 group-focus-within:block"
                        ></div>
                    </div>
                </div>
            {% endif %}

            {% if request.user.is_authenticated %}
                {% if request.user.profile.github_account %}
                    <a
                        href="{% url 'profile_detail' request.user.profile.github_account %}"
                        class="hidden py-2 px-3 text-sm font-bold rounded-md transition-colors sm:block text-primary-foreground/80 hover:text-primary-foreground hover:bg-primary-foreground/5"
                    >
                        {{ request.user.username }}
                    </a>
                {% endif %}
                {% if request.user.is_staff %}
                    <a
                        href="{% url 'admin:index' %}"
                        class="hidden py-2 px-3 text-sm font-bold rounded-md transition-colors sm:block text-primary-foreground/80 hover:text-primary-foreground hover:bg-primary-foreground/5"
                    >
                        {% translate "Admin Dashboard" %}
                    </a>
                {% endif %}
                <a href="{% url 'logout' %}" class="hidden sm:inline-flex btn-secondary">{% translate "Log Out" %}</a>
            {% else %}
                <a href="{% url 'social:begin' 'github' %}" class="hidden sm:inline-flex btn-secondary">{% translate "Log In" %}</a>
            {% endif %}

            <!-- Mobile menu button -->
            <button
                id="mobile-menu-btn"
                class="p-2 rounded-md transition-colors md:hidden text-primary-foreground hover:bg-primary-foreground/10"
            >
                <i class="text-xl ph-bold ph-list" id="menu-icon"></i>
            </button>
        </div>
    </div>

    <!-- Mobile menu -->
    <div
        id="mobile-menu"
        class="hidden border-t md:hidden bg-primary border-primary-foreground/10"
    >
        <nav class="container py-4 px-4 mx-auto space-y-3">
            {% if request.resolver_match.url_name != 'home' %}
                <!-- Mobile Search Bar - Only shown on non-home pages -->
                <div class="relative">
                    <div class="relative group">
                        <i
                            class="absolute left-3 top-1/2 text-base transition-colors transform -translate-y-1/2 ph-bold ph-magnifying-glass text-primary-foreground/60 group-focus-within:text-muted-foreground"
                        ></i>
                        <input
                            id="mobile-navbar-search-input"
                            type="text"
                            name="q"
                            placeholder="{% translate 'Search packages...' %}"
                            class="py-2 pr-12 pl-10 w-full h-9 rounded-md border-2 transition-colors focus:outline-none bg-primary-foreground/10 border-primary-foreground/20 text-primary-foreground placeholder:text-primary-foreground/60 focus:bg-background focus:text-foreground focus:border-primary focus:placeholder:text-muted-foreground"
                            autocomplete="off"
                            hx-get="{% url 'search_suggestions' %}"
                            hx-trigger="keyup changed delay:300ms, focus[this.value.trim().length > 0]"
                            hx-target="#mobile-navbar-suggestions-dropdown"
                            hx-vals='{"dropdown_id": "mobile-navbar-suggestions-dropdown"}'
                            hx-indicator="#mobile-navbar-search-spinner"
                        />
                        <div
                            class="flex absolute right-3 top-1/2 items-center space-x-1 transform -translate-y-1/2"
                        >
                            <div id="mobile-navbar-search-spinner" class="htmx-indicator">
                                <i
                                    class="animate-spin ph-bold ph-circle-notch text-muted-foreground"
                                ></i>
                            </div>
                        </div>
                        <!-- Suggestions Dropdown -->
                        <div
                            id="mobile-navbar-suggestions-dropdown"
                            class="hidden overflow-hidden absolute right-0 left-0 top-full z-50 mt-2 rounded-xl border-2 shadow-xl empty:hidden peer-focus:block peer-placeholder-shown:hidden bg-popover/95 backdrop-blur-sm border-border/50 group-focus-within:block"
                        ></div>
                    </div>
                </div>
            {% endif %}

            <a href="{% url 'packages' %}" class="block py-2 px-3 text-base font-medium rounded-md transition-colors text-primary-foreground/80 hover:text-primary-foreground hover:bg-primary-foreground/5">{% translate "Packages" %}</a>
            <a href="{% url 'grids' %}" class="block py-2 px-3 text-base font-medium rounded-md transition-colors text-primary-foreground/80 hover:text-primary-foreground hover:bg-primary-foreground/5">{% translate "Grids" %}</a>
            {% if request.user.is_authenticated %}
                {% if request.user.profile.github_account %}
                    <a href="{% url 'profile_detail' request.user.profile.github_account %}" class="block py-2 px-3 text-base font-medium rounded-md transition-colors text-primary-foreground/80 hover:text-primary-foreground hover:bg-primary-foreground/5">{{ request.user.username }}</a>
                {% endif %}
                {% if request.user.is_staff %}
                    <a href="{% url 'admin:index' %}" class="block py-2 px-3 text-base font-medium rounded-md transition-colors text-primary-foreground/80 hover:text-primary-foreground hover:bg-primary-foreground/5">{% translate "Admin Dashboard" %}</a>
                {% endif %}
                <a href="{% url 'logout' %}" class="block py-2 px-3 text-base font-medium rounded-md transition-colors text-primary-foreground/80 hover:text-primary-foreground hover:bg-primary-foreground/5">{% translate "Log Out" %}</a>
            {% else %}
                <a href="{% url 'social:begin' 'github' %}" class="block py-2 px-3 text-base font-medium rounded-md transition-colors text-primary-foreground/80 hover:text-primary-foreground hover:bg-primary-foreground/5">{% translate "Log In" %}</a>
            {% endif %}
        </nav>
    </div>
</header>
