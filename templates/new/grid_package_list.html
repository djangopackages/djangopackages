{% extends 'new/base.html' %}
{% load i18n page_metadata_tags %}

{% block metadata %}
    {% translate " Grid Packages" as trans_title %}
    {% page_metadata page_title=grid.title|add:trans_title %}
    {% page_metadata page_title=grid.title page_description=grid.description og_image_url=grid.get_opengraph_image_url %}
{% endblock metadata %}

{% block content %}
    <!-- Breadcrumb Section -->
    <section class="py-4 bg-primary/10">
        <div class="container px-4 mx-auto">
            <div class="flex flex-col gap-3 sm:flex-row sm:justify-between sm:items-center">
                <div class="flex items-center text-sm text-muted-foreground">
                    <a href="{% url 'home' %}" class="hover:underline">{% translate "Home" %}</a>
                    <span class="mx-2">»</span>
                    <a href="{% url 'grids' %}" class="hover:underline">{% translate "Grids" %}</a>
                    <span class="mx-2">»</span>
                    <a href="{% url 'grid' grid.slug %}" class="hover:underline">{{ grid.title }}</a>
                    <span class="mx-2">»</span>
                    <span class="font-medium text-foreground truncate">{% translate "Packages" %}</span>
                </div>
                <div class="flex flex-wrap gap-2 items-center w-full sm:w-auto">
                    {% if request.user.is_authenticated and request.user.profile.can_add_package %}
                        <a href="{% url 'add_grid_package' grid_slug=grid.slug %}" class="flex-1 flex-shrink-0 sm:flex-none btn-secondary">
                            <i class="mr-1 text-base ph-bold ph-plus"></i>
                            <span>{% translate "Add Package to the Grid" %}</span>
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </section>

    <div class="container py-8 px-4 mx-auto">
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-foreground">{{ grid.title }} {% translate "Packages" %}</h1>
            <p class="pt-2 text-muted-foreground">{{ grid.description|default:"" }}</p>
        </div>

        <div class="card">
            <div class="p-6 card-content">
                <!-- Search Input -->
                <div class="relative mb-8">
                    <i class="absolute left-3.5 top-1/2 text-lg -translate-y-1/2 ph-bold ph-magnifying-glass text-muted-foreground"></i>
                    <input type="text"
                           name="q"
                           class="pr-4 pl-11 w-full h-12 rounded-lg border shadow-sm transition-shadow focus:ring-2 focus:outline-none bg-background text-foreground focus:ring-primary"
                           placeholder="{% translate 'Search packages in this grid...' %}"
                           value="{{ search_query }}"
                           hx-get="{{ list_url }}"
                           hx-trigger="keyup changed delay:300ms"
                           hx-target="#package-list-container"
                           hx-include="#package-list-state input"
                           hx-push-url="true">
                </div>

                <div id="package-categories-container">
                    {% include "new/partials/package_categories.html" %}
                </div>
            </div>
        </div>

        <div class="mt-6 card">
            <div class="p-6 card-content">
                <div id="package-list-container">
                    {% include "new/partials/package_list_body.html" %}
                </div>
            </div>
        </div>
    </div>
{% endblock content %}
